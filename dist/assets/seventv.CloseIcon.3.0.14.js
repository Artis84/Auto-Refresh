var L=Object.defineProperty;var q=(e,t,s)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var S=(e,t,s)=>(q(e,typeof t!="symbol"?t+"":t,s),s);import{a as g,l as $,a9 as b,r as N}from"./seventv.useUserAgent.3.0.14.js";import{R as k,aK as M,L as y,aD as F,Q as G,_ as H,l as U,f as O,j as Q}from"./seventv.index.3.0.14.js";function p(e,t,s){return Math.min(Math.max(e,s),t)}class V extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var h=V;function A(e){if(typeof e!="string")throw new h(e);if(e.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=e.trim();t=D.test(e)?J(e):e;const s=X.exec(t);if(s){const l=Array.from(s).slice(1);return[...l.slice(0,3).map(r=>parseInt(x(r,2),16)),parseInt(x(l[3]||"f",2),16)/255]}const o=Y.exec(t);if(o){const l=Array.from(o).slice(1);return[...l.slice(0,3).map(r=>parseInt(r,16)),parseInt(l[3]||"ff",16)/255]}const u=Z.exec(t);if(u){const l=Array.from(u).slice(1);return[...l.slice(0,3).map(r=>parseInt(r,10)),parseFloat(l[3]||"1")]}const d=I.exec(t);if(d){const[l,r,c,a]=Array.from(d).slice(1).map(parseFloat);if(p(0,100,r)!==r)throw new h(e);if(p(0,100,c)!==c)throw new h(e);return[...ee(l,r,c),Number.isNaN(a)?1:a]}throw new h(e)}function K(e){let t=5381,s=e.length;for(;s;)t=t*33^e.charCodeAt(--s);return(t>>>0)%2341}const B=e=>parseInt(e.replace(/_/g,""),36),W="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((e,t)=>{const s=B(t.substring(0,3)),o=B(t.substring(3)).toString(16);let u="";for(let d=0;d<6-o.length;d++)u+="0";return e[s]=`${u}${o}`,e},{});function J(e){const t=e.toLowerCase().trim(),s=W[K(t)];if(!s)throw new h(e);return`#${s}`}const x=(e,t)=>Array.from(Array(t)).map(()=>e).join(""),X=new RegExp(`^#${x("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Y=new RegExp(`^#${x("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Z=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${x(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),I=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,D=/^[a-z]+$/i,C=e=>Math.round(e*255),ee=(e,t,s)=>{let o=s/100;if(t===0)return[o,o,o].map(C);const u=(e%360+360)%360/60,d=(1-Math.abs(2*o-1))*(t/100),l=d*(1-Math.abs(u%2-1));let r=0,c=0,a=0;u>=0&&u<1?(r=d,c=l):u>=1&&u<2?(r=l,c=d):u>=2&&u<3?(c=d,a=l):u>=3&&u<4?(c=l,a=d):u>=4&&u<5?(r=l,a=d):u>=5&&u<6&&(r=d,a=l);const n=o-d/2,f=r+n,_=c+n,m=a+n;return[f,_,m].map(C)};function te(e){const[t,s,o,u]=A(e).map((f,_)=>_===3?f:f/255),d=Math.max(t,s,o),l=Math.min(t,s,o),r=(d+l)/2;if(d===l)return[0,0,r,u];const c=d-l,a=r>.5?c/(2-d-l):c/(d+l);return[60*(t===d?(s-o)/c+(s<o?6:0):s===d?(o-t)/c+2:(t-s)/c+4),a,r,u]}function se(e,t,s,o){return`hsla(${(e%360).toFixed()}, ${p(0,100,t*100).toFixed()}%, ${p(0,100,s*100).toFixed()}%, ${parseFloat(p(0,1,o).toFixed(3))})`}function ne(e,t){const[s,o,u,d]=te(e);return se(s,o,u-t,d)}function R(e){if(e==="transparent")return 0;function t(d){const l=d/255;return l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4)}const[s,o,u]=A(e);return .2126*t(s)+.7152*t(o)+.0722*t(u)}function re(e,t){const s=R(e),o=R(t);return s>o?(s+.05)/(o+.05):(o+.05)/(s+.05)}const oe={decorative:1.5,readable:3,aa:4.5,aaa:7};function T(e,t="aa",s="#fff"){return re(e,s)<oe[t]}const w=e=>{const t=e>>>24&255,s=e>>>16&255,o=e>>>8&255,u=e&255;return`rgba(${t}, ${s}, ${o}, ${(u/255).toFixed(3)})`},ie=(e,t,s,o)=>e<<24|t<<16|s<<8|o,xe=(e,t)=>{const s=e>>>24&255,o=e>>>16&255,u=e>>>8&255,d=e&255;return"#"+((1<<24)+(s<<16)+(o<<8)+u).toString(16).slice(1)+(t?ae(d/255):"")},ae=e=>{if(e>1||e<0||isNaN(e))throw Error("alpha must be between 0 and 1");return Math.ceil(255*e).toString(16).toUpperCase()},be=(e,t=1)=>{const s=parseInt((e==null?void 0:e.slice(1))??"0",16),o=s>>16&255,u=s>>8&255,d=s&255;return ie(o,u,d,255*Math.min(t,1))},v={0:{},1:{}};function ke(e,t){let s=e.toLowerCase();const o=t?"#0f0e11":"#faf9fa";if(!T(s,"aa",o))return s;const u=v[t][e];if(u)return u;const d=A(s).slice(0,3);if(t&&d.every(r=>r<36))return v[t][e]="#7a7a7a","#7a7a7a";let l=0;for(;T(s,"aa",o)&&l<50;)s=ne(s,.1*(t?-1:1)),l++;return v[t][e]=s,s}const i=g({cosmetics:{},sets:{},activeSets:new Set,entitlementBuffers:{"+":[],"-":[]},userBadges:{},userPaints:{},userEmoteSets:{},userEmoteMap:{},staticallyAssigned:{}});class j extends Map{constructor(){super(...arguments);S(this,"providers",new Set)}hasProvider(s){return this.providers.has(s)}set(s,o){return o.provider&&this.providers.add(o.provider),super.set(s,o)}delete(s){const o=this.get(s);return o?(this.providers.delete(o.provider),super.delete(s)):!1}clear(){this.providers.clear(),super.clear()}}let z=null;k.ready().then(async()=>{const{target:e}=G();M(()=>k.cosmetics.toArray(),r=>{i.cosmetics={};for(const c of r)i.cosmetics[c.id]||(i.cosmetics[c.id]=g(c),c.kind==="PAINT"&&P(c))}),e.addEventListener("static_cosmetics_fetched",r=>{const{badges:c,paints:a}=r.detail;for(let n of c??[]){i.cosmetics[n.id]?n=i.cosmetics[n.id]:i.cosmetics[n.id]=g(n);for(const f of n.user_ids??[])!f||i.userBadges[f]&&i.userBadges[f].has(n.id)||(t({id:"",kind:"BADGE",ref_id:n.id,user_id:f},"+"),i.staticallyAssigned[f]={});n.user_ids&&(n.user_ids.length=0)}for(let n of a??[]){i.cosmetics[n.id]?n=i.cosmetics[n.id]:i.cosmetics[n.id]=g(n);for(const f of n.user_ids??[])!f||i.userPaints[f]||(t({id:"",kind:"PAINT",ref_id:n.id,user_id:f},"+"),i.staticallyAssigned[f]={});n.user_ids&&(n.user_ids.length=0),P(n)}},{once:!0});function t(r,c){var a,n;if(i.staticallyAssigned[r.user_id]){for(const f of((a=i.userBadges[r.user_id])==null?void 0:a.values())??[])f.provider==="7TV"&&i.userBadges[r.user_id].delete(f.id);for(const f of((n=i.userPaints[r.user_id])==null?void 0:n.values())??[])i.userPaints[r.user_id].delete(f.id);delete i.staticallyAssigned[r.user_id]}i.entitlementBuffers[c].push(r),s()}function s(){z||(z=window.setTimeout(()=>{const r=i.entitlementBuffers["+"].splice(0,i.entitlementBuffers["+"].length),c=i.entitlementBuffers["-"].splice(0,i.entitlementBuffers["-"].length);for(const a of c){const n=u(a.kind);!n[a.user_id]||!n[a.user_id].has(a.ref_id)||n[a.user_id].delete(a.ref_id)}z=window.setTimeout(async()=>{for(const a of r){const n=u(a.kind);if(a.kind==="EMOTE_SET")n[a.user_id]||(n[a.user_id]=new Map),l(a.user_id,a.ref_id);else{n[a.user_id]||(n[a.user_id]=new j);const f=n[a.user_id];o(a.ref_id).then(_=>{f.has(a.ref_id)||f.hasProvider(_.provider)||f.set(a.ref_id,_)})}}},10),z=null},10))}function o(r){const c=i.cosmetics[r];return c?Promise.resolve(c):y(()=>i.cosmetics[r]).not.toBeUndefined()}function u(r){return{BADGE:i.userBadges,PAINT:i.userPaints,EMOTE_SET:i.userEmoteSets}[r]}function d(r,c){const a=N(null);return i.userEmoteMap[r]={},M(()=>k.emoteSets.where("id").equals(c).first(),n=>{var f;a.value=n,i.sets[c]=a.value,i.userEmoteMap[r]=a.value.emotes.filter(_=>{var m;return _.data&&((m=_.data.state)==null?void 0:m.includes("PERSONAL"))}).reduce((_,m)=>({..._,[m.name]:m}),{}),(f=i.userEmoteSets[r])==null||f.set(c,a.value)},{until:y(i.userEmoteMap[r]).toBeUndefined().then(()=>!0)}),a}async function l(r,c){const a=d(r,c),n=await Promise.race([y(a).not.toBeNull(),y(F(1e4)).toBeTruthy().then(()=>null)]);if(!n){delete i.userEmoteMap[r],$.warn("<Cosmetics>","Emote Set could not be found",`id=${c}`);return}i.userEmoteSets[r]||(i.userEmoteSets[r]=new Map),i.userEmoteSets[r].has(c)||i.userEmoteSets[r].set(c,n),$.debug("<Cosmetics>","Assigned Emote Set to user",`id=${c}`,`userID=${r}`)}e.addEventListener("entitlement_created",r=>{t(r.detail,"+")}),e.addEventListener("entitlement_deleted",r=>{t(r.detail,"-")}),k.entitlements.toArray().then(r=>{var c,a;for(const n of r){let f=!1;const _=!!i.staticallyAssigned[n.user_id];switch(n.kind){case"BADGE":if(!_&&((c=i.userBadges[n.user_id])!=null&&c.size))continue;t(n,"+"),f=!0;break;case"PAINT":if(!_&&((a=i.userPaints[n.user_id])!=null&&a.size))continue;t(n,"+"),f=!0;break;case"EMOTE_SET":l(n.user_id,n.ref_id);break}$.debug("<Cosmetics>","Assigned",r.length.toString(),"stored entitlements"),f&&(i.staticallyAssigned[n.user_id]={})}})});function ye(e){return i.userBadges[e]||(i.userBadges[e]=new j),i.userPaints[e]||(i.userPaints[e]=new j),i.userEmoteMap[e]||(i.userEmoteMap[e]={}),g({paints:b(i.userPaints,e),badges:b(i.userBadges,e),emotes:b(i.userEmoteMap,e),emoteSets:b(i.userEmoteSets,e)})}function ze(){return i}let E=null;function ce(){if(E)return E;const e=document.createElement("link");e.type="text/css",e.rel="stylesheet";const t=document.createElement("style");return t.id="seventv-paint-styles",document.head.appendChild(t),E=t.sheet??null}function P(e,t=!1){var c,a;const s=ce();if(!s){$.error("<Cosmetics>","Could not find paint stylesheet");return}!((c=e.data.gradients)!=null&&c.length)&&e.data.function&&(e.data.gradients||(e.data.gradients=new Array(1)),e.data.gradients[0]={function:e.data.function,canvas_repeat:"",size:[1,1],shape:e.data.shape,image_url:e.data.image_url,stops:e.data.stops??[],repeat:e.data.repeat??!1,angle:e.data.angle});const o=e.data.gradients.map(n=>ue(n)),u=(()=>e.data.shadows?e.data.shadows.map(n=>de(n)).join(" "):"")(),d=`.seventv-paint[data-seventv-paint-id="${e.id}"]`,l=`${d} {
color: ${e.data.color?w(e.data.color):"inherit"};
background-image: ${o.map(n=>n[0]).join(", ")};
background-position: ${o.map(n=>n[1]).join(", ")};
background-size: ${o.map(n=>n[2]).join(", ")};
background-repeat: ${o.map(n=>n[3]).join(", ")};
filter: ${u||"inherit"};
${e.data.text?`
font-weight: ${e.data.text.weight?e.data.text.weight*100:"inherit"};
-webkit-text-stroke-width: ${e.data.text.stroke?`${e.data.text.stroke.width}px`:"inherit"};
-webkit-text-stroke-color: ${e.data.text.stroke?w(e.data.text.stroke.color):"inherit"};
text-shadow: ${((a=e.data.text.shadows)==null?void 0:a.map(n=>`${n.x_offset}px ${n.y_offset}px ${n.radius}px ${w(n.color)}`).join(", "))??"unset"};
text-transform: ${e.data.text.transform??"unset"};
`:""}
}
`;let r=-1;for(let n=0;n<s.cssRules.length;n++){const f=s.cssRules[n];if(f instanceof CSSStyleRule&&f.selectorText===d){r=n;break}}t||(r>=0?(s.deleteRule(r),s.insertRule(l,r)):s.insertRule(l,s.cssRules.length))}function ue(e){const t=["","","",""],s=[];switch(e.function){case"LINEAR_GRADIENT":s.push(`${e.angle??0}deg`);break;case"RADIAL_GRADIENT":s.push(e.shape??"circle");break;case"URL":s.push(e.image_url??"");break}let o="";if(e.function!=="URL"){o=e.repeat?"repeating-":"";for(const u of e.stops){const d=w(u.color);s.push(`${d} ${u.at*100}%`)}}return t[0]=`${o}${e.function.toLowerCase().replace("_","-")}(${s.join(", ")})`,t[1]=e.at&&e.at.length===2?`${e.at[0]*100}% ${e.at[1]*100}%`:"",t[2]=e.size&&e.size.length===2?`${e.size[0]*100}% ${e.size[1]*100}%`:"",t[3]=e.canvas_repeat??"unset",t}function de(e){return`drop-shadow(${e.x_offset}px ${e.y_offset}px ${e.radius}px ${w(e.color)})`}const le={},fe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"1em",height:"1em",fill:"currentColor"},_e=Q("path",{d:"M68.6 57.4L46 34.7 .7 80l22.6 22.6L176.7 256 23.4 409.4 .7 432 46 477.3l22.6-22.6L222 301.3 375.4 454.6 398 477.3 443.3 432l-22.6-22.6L267.3 256 420.6 102.6 443.3 80 398 34.7 375.4 57.4 222 210.7 68.6 57.4z"},null,-1),me=[_e];function he(e,t){return U(),O("svg",fe,me)}const $e=H(le,[["render",he]]);export{$e as C,w as D,be as H,ae as S,xe as a,de as b,ue as c,P as d,ze as g,ke as n,ye as u};
